# 问题解答

## 1.解释中断向量

对应每个中断源设置一个向量。这些向量顺序存在主存储器的特定存储区。向量的内容是相应中断服务程序的起始地址和处理机状态字。在响应中断时，由中断系统硬件提供向量地址，处理机根据该地址取得向量，并转入相应的中断服务程序

## 2.解释中断类型码

我们把每个中断服务程序进行编号，这个号就代表一个中断服务程序，就是中断类型码。这个中断类型码是计算机用来查找中断向量用的。

## 3.解释中断向量表

中断向量表是指中断服务程序入口地址的偏移量与段基值，一个中断向量占据4字节空间。中断向量表是8086系统内存中最低端1K字节空间，它的作用就是按照中断类型号从小到大的顺序存储对应的中断向量，总共存储256个中断向量。

## 4.实模式下中断程序地址如何得到

使用中断向量表(存在内存单元的最低1K字节处，中断类型码*4即可得中断向量的地址)。中断向量为4字节，即为中断程序的地址。

## 5.保护模式下中断程序地址如何得到

在保护模式下，为每一个中断和异常定义了一个中断描述程序地址信息外，还包括许多符，来说明中断和异常服务程序的入口地址的属性  
中断描述符除了含有中断处理属性和类型位  
每个中断描述符占用连续的8个字节，中断描述符分为三类：任务门、中断门和自陷门，CPU对不同的门有不同的处理方式  

外部产生中断(8259A)或者程序使用int指令时传入中断向量码，先从IDT表中得到中断描述符，由描述符得到中断程序地址。

## 6.中断向量的地址如何得到

中断码乘以4，因为中断向量表存在内存的最低1k字节。

## 7.实模式下如何根据中断向量的地址得到中断程序地址

取中断向量地址指向的4字节，即为中断程序的地址

## 8.解释中断描述符

中断描述符如下：

```text
|   7    |   6    |     5     |    4    |   3    |   2    |   1    |   0    |  字节
|76543210|76543210|7 65 4 3210 765 43210|76543210|76543210|76543210|76543210|  比特
|--------|--------|-|--|-|----|---|-----|--------|--------|--------|--------|  占位
|<--BIAS A31-A16->|P|DP|S|TYPE|000|PRESE|Segement Selector|<--BIAS A15-A0-->|  含义
                  | |L | |    |   |RVE
```

- P（present）：表示中断描述符的有效性，即是否在内存中，1为在，否则为0
- DPL(descriptor privilege level)：描述符特权级，可以为0、1、2、3
- TYPE：指示中断描述符的不同类型，包括任务门、中断门、陷阱门
- S：指明是数据段/代码段描述符(S=1)，还是系统段/门描述符(S=0)

## 9.保护模式下中断描述符表如何得到

在80x86系列中为中断服务提供中断/陷阱描述符，这些描述符构成中断描述符表（IDT）  
引入一个48位的全地址寄存器（即中断描述符表寄存器IDTR）存放IDT的内存地址，因此不再限于底部1K位置  
和GDTR一样，IDTR包含32位的基地址和16位段限，基地址定义中断描述符表IDT在存储器中的起始点，段限定义中断描述符表所占的字节个数  
理论上IDT表同样可以有8K项，可是因为80x86只支持256个中断，因此IDT实际上最大只能有256项（2K大小）  

## 10.保护模式下中断门如何得到

1. 装载中断描述符表寄存器(IDT)
2. 查中断描述符表以IDTR指定的中断描述符表的基地址为起始地址，用调用号N×8算出偏移量，即为N号中断门描述符的首地址，由此处取出中断门的8个字节
3. 查全局或局部描述符表根据中断门中的选择子（段选择符）和偏移量得到中断处理程序入口

?为什么会有LDT，至少书中的图没显示LDT。

## 11.保护模式下如何根据中断门得到中断处理程序地址

中断门中存有选择子和偏移量，选择子在GDT/LDT中查找段描述符进而找到段基址，加上偏移得到程序基址

## 12.中断的分类，举例不同类型的中断

1. 从中断源的角度分类
    1. 由计算机硬件异常或故障引起的中断，也称为内部异常中断。
    2. 由程序中执行了中断指令引起的中断，也称为软中断。由程序员通过INT或INT3指令触发，通常当做trap处理，用处：实现系统调用。
    3. 外部设备（如输入输出设备）请求引起的中断，也称为外部中断或I/O中断。
2. 主要有两类：
    1. 由CPU以外的事件引起的中断——**中断**
        - 如I/O中断、时钟中断、控制台中断等。
    2. 来自CPU的内部事件或程序执行中的事件引起的过程——**异常**
        - 如由于CPU本身故障、程序故障和请求系统服务的指令引起的中断等

## 13.中断和异常的区别

1. 中断，是CPU所具备的功能。通常因为“硬件”而随机发生。异常，是“软件”运行过程中的一种开发过程中没有考虑到的程序错误。
2. 中断是CPU暂停当前工作，有计划地去处理其他的事情。中断的发生一般是可以预知的，处理的过程也是事先制定好的。处理中断时程序是正常运行的。异常是CPU遇到了无法响应的工作，而后进入一种非正常状态。异常的出现表明程序有缺陷。
3. 中断是异步的，异常是同步的。  
中断是来自处理器外部的I/O设备的信号的结果，它不是由指令流中某条指令执行引起的，从这个意义上讲，它是异步的，是来自指令流之外的。  
异常是执行当前指令流中的某条指令的结果，是来自指令流内部的，从这个意义上讲它们都是同步的。
4. 中断或异常的返回点  
良性的如中断和trap，只是在正常的工作流之外执行额外的操作，然后继续干没干完的活。因此处理程序完了后返回到原指令流的下一条指令，继续执行。  
恶性的如fault和abort，对于可修复fault，由于是在上一条指令执行过程中发生（是由正在执行的指令引发的）的，在修复fault之后，会重新执行该指令；至于不可修复fault或abort，则不会再返回。
5. 中断是由于当前程序无关的中断信号触发的，CPU对中断的响应是被动的，且与CPU模式无关。既可以发生在用户态，又可以发生在核心态。异常是由CPU控制单元产生的，大部分异常发生在用户态。

## 14.实模式和保护模式下中断处理差别

保护模式下的中断处理与实模式下的中断处理最大区别在于寻找中断处理代码入口的方式

## 15.如何识别键盘组合键(如Shift+a)是否还有其它解决方案

连续的make码，记录状态。

## 16.IDT是什么，有什么作用

中断描述符表，保存了中断程序的段基址，偏移，权限等信息。

## 17.IDT中有几种描述符

任务门、中断门、陷阱门  

- 任务门(task gate)  
当中断信号发生时，必须取代当前进程的那个进程的TSS选择符存放在任务门中。
- 中断门(interruptgate)  
包含段选择符和中断或异常处理程序的段内偏移量.当控制权转移到一个适当的段时，处理器 清IF标志，从而关闭将来会发生的可屏蔽中断.
- 陷阱门(Trap gate)  
与中断门相似，只是控制权传递到一个适当的段时处理器不修改IF标志.

## 18.异常的分类

- Fault，是一种可被更正的异常，而且一旦被更正，程序可以不失连续性地继续执行。返回地址是产生fault的指令。
- Trap，一种在发生trap的指令执行之后立即被报告的异常，它也允许程序或任务不失连续性地继续执行。返回地址是产生trap的指令之后的那条指令。
- Abort，不总是报告精确异常发生位置的异常，不允许程序或任务继续执行，而是用来报告严重错误的。

错误，陷阱和终止。

## 19.用户态和内核态的特权级分别是多少

3和0

## 20.中断向量表中，每个中断有几个字节？里面的结构是什么

4字节。每一个中断向量所包含的地址以低位二字节存储偏移量，高位二字节存储段地址。

## 21.中断异常共同点(至少两点)，不同点(至少三点)

相同点：

- 都是程序执行过程中的强制性转移，转移到相应的处理程序。
- 都是软件或者硬件发生了某种情形而通知处理器的行为

不同点：看上边
