# 问题解答

## 一、PPT相关内容

### 1.什么是实模式，什么是保护模式

1. 实模式就是用基地址加偏移量就可以直接拿到物理地址的模式。
实模式（英语：Real mode）是Intel 80286和之后的x86兼容CPU的操作模式。实模式的特性是一个20比特的区段存储器地址空间（意思为只有1MB的存储器可以被定址），可以直接软件访问BIOS例程以及周边硬件，没有任何硬件等级的存储器保护观念或多任务。所有的80286系列和之后的x86 CPU都是以实模式下引导；80186和早期的CPU仅仅只有一种操作模式，也就是相当于后来芯片的这种实模式。  
缺点：实模式非常不安全。

2. 保护模式就是不能直接拿到物理地址的模式。  
因此需要进行地址转换。从80386开始，是现代操作系统的主要模式。1985年问世的80386开启了32位CPU时代。地址总线为32比特，寻址空间为232（即4 GiB）。386 CPU保护模式下有两种内存寻址方式：  

- 可以分页寻址，这是此后的x86上的Windows操作系统与Linux操作系统最广泛采用的方法；
- 也可以非分页寻址而采取与286保护模式兼容的寻址方式，采用32位的选择器（selector）寄存器与32位的偏移量寄存器寻址，这时描述符表的条目中保存的段起始物理地址为32位，而段长的数据宽度为20位，但可以设置段长的粒度为1B或4KiB，所以段的最大长度可以是1 MiB或者4 GiB。

IA32的CPU通过两级：页目（page directory）与页表（page table）实现4KiB的分页管理，这是最常见的IA32分页寻址方式。  
从应用程序角度，不再使用段地址寄存器（或称选择器），仅使用32位的偏移量，为232（即4GiB）的连续线性寻址空间。  
参考: [维基百科: 实模式](https://zh.wikipedia.org/wiki/%E7%9C%9F%E5%AF%A6%E6%A8%A1%E5%BC%8F)、[维基百科: 保护模式](https://zh.wikipedia.org/wiki/%E4%BF%9D%E8%AD%B7%E6%A8%A1%E5%BC%8F)

### 2.什么是选择子

段选择子是一个16位的整数（段寄存器的16位可见部分），存储寻找段描述符的相关信息。其结构如下：  

```[text]
|   1   |     0    |  字节
|7654321076543 2 10|  比特
|-------------|-|--|  占位
|    INDEX    |T|R |  含义
|             |I|P |
|             | |L |
```

其中：

- INDEX：在GDT数组或LDT数组的索引号
- TI：Table Indicator,这个值为0表示查找GDT，1则查找LDT
- RPL：请求特权级。以什么样的权限去访问段。  

### 3.什么是描述符

保护模式下引入描述符来描述各种数据段，所有的描述符均为8个字节，由第5个字节来说明描述符的类型。类型不同，描述符的结构也不同。  
段描述符结构如下：

```[text]
|   7    |     6       |     5     |   4    |   3    |   2    |   1    |   0    |  字节
|76543210|7 6 5 4 3210 |7 65 4 3210|76543210|76543210|76543210|76543210|76543210|  比特
|--------|-|-|-|-|---- |-|--|-|----|--------|--------|--------|--------|--------|  占位
|  BASE  |G|D|0|A|LIMIT|P|D |S|TYPE|<------- BASE 23-0 ------>|<-- LIMIT 15-0 ->|  含义
|  31-24 | |/| |V|19-16| |P |
           |B| |L|     | |L |
```

其中：  

- BASE: 段基址，由上图中的两部分(BASE 31-24 和 BASE 23-0)组成
- G：LIMIT的单位，该位 0 表示单位是字节，1表示单位是 4KB
- D/B: 该位为 0 表示这是一个 16 位的段，1 表示这是一个 32 位段
- AVL: 该位是用户位，可以被用户自由使用
- LIMIT: 段的界限，单位由 G 位决定。数值上（经过单位换算后的值）等于段的长度（字节）- 1。
- P: 段存在位，该位为 0 表示该段不存在，为 1 表示存在。
- DPL：段权限
- S: 该位为 1 表示这是一个数据段或者代码段。为 0 表示这是一个系统段（比如调用门，中断门等）
- TYPE: 根据 S 位的结果，再次对段类型进行细分。  

### 4.什么是GDT，什么是LDT

1. GDT：全局描述符表，是全局唯一的。存放一些公用的描述符、和包含各进程局部描述符表首地址的描述符。
2. LDT：局部描述符表，每个进程都可以有一个。存放本进程内使用的描述符。  
(以上可以理解为二级的表的结构，意为存放的都是各进程的段表的表，因为描述符记录着段表的基址)

### 5.请分别说明GDTR和LDTR的结构

1. GDTR(48位)寄存器中，高32位存放GDT表的首地址，低16位记录表的大小。  
2. LDTR(16位)寄存器中保存一个特殊的选择子，用于查找当前进程的LDT首地址。  

### 6.请说明GDT直接查找物理地址的具体步骤

1. 给出段选择子+偏移量
段选择子记录着对GDT表的索引、类型(必为0)，和权限；偏移代表寻址偏移。
2. 选择了GDT方式(段选择子第三位为0)，从GDTR获取GDT首地址，用段选择子中的13位做偏移，拿到GDT中的描述符
描述符记录着为当前进程的段表基址，
3. 如果合法(不超过GDT表长度)且有权限(段选择子头2位代表权限)，用描述符中的段首地址加上1)中的偏移量找到物理地址。寻址结束。

### 7.请说明通过LDT查找物理地址的具体步骤

1. 给出段选择子+偏移量
段选择子记录着对LDT表的索引，查找类型(必为1)，和权限；偏移嗲表寻址偏移。
2. 若选择了LDT方式(段选择子第三位为1)，从GDTR获取GDT首地址，用LDTR中的偏移量做偏移，拿到GDT中的描述符1
LDTR记录着对GDT表的索引；描述符1记录着LDT表的基址。
3. 从描述符1中获取LDT首地址，用段选择子中的13位做偏移，拿到LDT中的描述符2
描述符2记录着当前进程的段表基址。
4. 如果合法且有权限，用描述符2中的段首地址加上1)中的偏移量找到物理地址。寻址结束。

### 8.根目录区大小一定么？扇区号是多少？为什么

根目录区最大有14个block(9728B)，扇区号从19开始，哪有为什么  

### 9.数据区第一个簇号是多少？为什么

在1.44M软盘上，FAT前三个字节的值是固定的0xF0、0xFF、0xFF，用于表示这是一个应用在1.44M软盘上的FAT12文件系统。本来序号为0和1的FAT表项应该对应于簇0和簇1，但是由于这两个表项被设置成了固定值，簇0和簇1就没有存在的意义了，所以数据区就起始于簇2。  

### 10.FAT表的作用

构成链表形式，作为数据区的索引。  

### 11.解释静态链接的过程

静态链接是指在编译阶段直接把静态库加入到可执行文件中去，这样可执行文件会比较大。
而动态链接则是指链接阶段仅仅只加入一些描述信息，而程序执行时再从系统中把相应动态库加载到内存中去。

### 12.解释动态链接的过程

### 13.静态链接相关PPT中为什么使用ld链接⽽不是gcc

### 14.linux下可执行文件的虚拟地址空间默认从哪里开始分配

## 二、实验相关内容

### 1.BPB指定字段的含义

### 2.如何进⼊子目录并输出（说明方法调用）

### 3.如何获得指定文件的内容，即如何获得数据区的内容（比如使用指针等）

### 4.如何进行C代码和汇编之间的参数传递和返回值传递

### 5.汇编代码中对I/O的处理方式，说明指定寄存器所存值的含义
